

name: compile
on:
   push:
     branches: [ develop ]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Run a one-line script
        run: pwd

#      - name: Get version
#        id: get_version
#        run: echo ::set-output name=VERSION::$(echo $GITHUB_REF | cut -d / -f 3)

      - run: |
          pwd
          ls -ltra
          mkdir -p m4bs
          chmod 755 DEBIAN/postins
          chmod 755 DEBIAN/postrm
          chmod 755 DEBIAN/prerm
          rm -rf .git
          rm -rf .github
          rm -rf README*
          rm -rf LICE*
          rm -rf .gitignore
          ls -l
          source "usr/share/doc/m4bs/version"
          echo "La version es: "${VERSION}
          dpkg-deb --build /home/runner/work/m4bs/m4bs
          cd /home/runner/work/m4bs
          ls -l
          mv m4bs.deb /home/runner/work/m4bs/m4bs/m4bs/m4bs-${VERSION}_armhf.deb
          cd m4bs/m4bs
          ls -l
          #git clone https://github.com/dcf-maker/ppa.git
          #mv m4bs-${VERSION}_armhf.deb ppa
          cd ppa
          ls -l
          git add .
          git commit -m "subida de la version ${VERSION}"
          git push
          
      - name: Pushes to another repository  
        uses: cpina/github-action-push-to-another-repository@main
        env:
          API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
        with:
          source-directory: 'm4bs'
          destination-github-username: 'dcf-maker'
          destination-repository-name: 'ppa'
          user-email: dcf-maker@gmail.com
          target-branch: main

      - uses: actions/upload-artifact@v2
        with:
          name: m4bs
          path: m4bs/